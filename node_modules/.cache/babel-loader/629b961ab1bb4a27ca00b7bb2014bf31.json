{"remainingRequest":"/Users/zhangoking/study/vue-cli/hello-word/node_modules/babel-loader/lib/index.js!/Users/zhangoking/study/vue-cli/hello-word/src/utils/ajax/index.js","dependencies":[{"path":"/Users/zhangoking/study/vue-cli/hello-word/src/utils/ajax/index.js","mtime":1549962411680},{"path":"/Users/zhangoking/study/vue-cli/hello-word/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhangoking/study/vue-cli/hello-word/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _objectSpread from \"/Users/zhangoking/study/vue-cli/hello-word/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _Promise from \"/Users/zhangoking/study/vue-cli/hello-word/node_modules/@babel/runtime-corejs2/core-js/promise\";\nimport _JSON$stringify from \"/Users/zhangoking/study/vue-cli/hello-word/node_modules/@babel/runtime-corejs2/core-js/json/stringify\";\nimport Vue from 'vue';\nimport axios from 'axios';\nimport qs from 'qs';\nimport { formatIntercepter, codeIntercepter, statusIntercepter } from './middleware/interceptor';\nimport { error } from './middleware/enum';\nvar vue = new Vue(); // 自定义拦截器\n\nvar interceptors = [formatIntercepter, codeIntercepter, statusIntercepter];\nvar loading; // 加载遮罩\n\nvar _csrfToken; // token\n// 自定义axios实例\n\n\nvar http = axios.create({\n  baseURL: '/easyFm',\n  // ms\n  timeout: 15000,\n  // 只适用'POST'、'PUT'、'PATCH'，序列化参数\n  transformRequest: [function (data) {\n    return _JSON$stringify(data);\n  }],\n  // GET请求，序列化参数，只有在有参数的情况先才会执行\n  paramsSerializer: function paramsSerializer(params) {\n    return qs.stringify(params, {\n      arrayFormat: 'brackets'\n    });\n  }\n});\n/**\n * 请求拦截器\n * @return {[type]}          [description]\n */\n\nhttp.interceptors.request.use(function (request) {\n  var method = request.method,\n      data = request.data,\n      params = request.params;\n\n  if (method.toLowerCase() === 'get') {\n    request.params = extendToken(params);\n  } else {\n    if (data instanceof FormData) {\n      request.data = data;\n    } else {\n      request.data = extendToken(data);\n    } // post请求不能重复提交\n    // 使用element loading全屏遮罩\n\n\n    loading = vue.$loading({\n      fullscreen: true\n    });\n  }\n\n  return request;\n});\n/**\n * 扩展响应\n * @return {[type]}           [description]\n */\n\nhttp.interceptors.response.use(function (response) {\n  response._i = 0;\n\n  response.next = function () {\n    if (response._i < interceptors.length) {\n      return interceptors[response._i++](response, response.next);\n    }\n  };\n\n  return response;\n});\n/**\n * 响应拦截器\n * @return {[type]}                 [description]\n */\n\nhttp.interceptors.response.use(function (response) {\n  console.log(response.next());\n  var code = response.data.code;\n\n  if (code == 218 || code == 219 || code == 217) {\n    store.dispatch('updateIsCertificateCode', code);\n    return _Promise.reject(response);\n  }\n\n  var config = response.config,\n      data = response.data;\n\n  if (config.method.toLowerCase() !== 'get') {\n    loading && loading.close();\n  }\n\n  setToken(data.token);\n  var result = response.next();\n\n  if (result) {\n    // 请求失败\n    switch (result) {\n      case error.LOGOUT:\n        // 未登录\n        user.showLogin();\n        break;\n\n      case error.LOGINERROR:\n      case error.LOGINFAIL:\n      case error.AUTHCODE:\n        // 登录失败\n        vue.$message.error(data.message);\n        user.showLogin();\n        break;\n\n      case error.AUTH:\n        // 没权限\n        vue.$message.error('权限已变更，请重新登录');\n        setTimeout(function () {\n          user.showLogin();\n        }, 1000);\n        break;\n\n      case error.FORMAT:\n        // 数据格式错误\n        vue.$message.error('接口数据格式错误');\n        break;\n\n      default:\n        vue.$message.error(data.message);\n    }\n\n    return _Promise.reject(data);\n  }\n\n  return data;\n}, function (error) {\n  loading && loading.close();\n  console.log(error);\n  return _Promise.reject(error);\n});\n\nfunction getToken() {\n  return _csrfToken || (process.env.NODE_ENV === 'production' ? window.localStorage['token'] : '');\n}\n\nfunction setToken(val) {\n  window.localStorage.setItem('token', val && (_csrfToken = val));\n}\n\nfunction extendToken(data) {\n  return _objectSpread({}, data, {\n    'csrf_token': getToken() // 添加token信息\n\n  });\n}\n/**\n * http工具函数\n * @param  {...[type]} config [description]\n * @return {[type]}         [description]\n */\n\n\nvar ajax = function ajax(config) {\n  return http(config);\n};\n\nObject.defineProperty(ajax, 'csrfToken', {\n  enumerable: false,\n  configurable: false,\n  get: function get() {\n    console.log('get');\n    return getToken();\n  },\n  set: function set(val) {\n    console.log('set');\n    setToken(val);\n  }\n});\n/**\n * ajax消息提示\n * @param  {[type]}  message            [description]\n * @param  {String}  options.type      [description]\n * @param  {Boolean} options.showClose [description]\n * @param  {[type]}  options.duration  [description]\n * @return {[type]}                    [description]\n */\n\najax.message = function (message) {\n  var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n      _ref$type = _ref.type,\n      type = _ref$type === void 0 ? 'error' : _ref$type,\n      _ref$showClose = _ref.showClose,\n      showClose = _ref$showClose === void 0 ? false : _ref$showClose,\n      _ref$duration = _ref.duration,\n      duration = _ref$duration === void 0 ? 3000 : _ref$duration;\n\n  vue.$message({\n    message: message,\n    type: type,\n    showClose: showClose,\n    duration: duration\n  });\n};\n/**\n * GET操作\n * @param  {...[type]} args [description]\n * @return {[type]}         [description]\n */\n\n\najax.get = function () {\n  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n    args[_key] = arguments[_key];\n  }\n\n  var url = args[0],\n      data = args[1],\n      options = args[2];\n  return http(_objectSpread({\n    url: url,\n    params: data,\n    method: 'get'\n  }, options));\n};\n/**\n * POST操作\n * @param  {...[type]} args [description]\n * @return {[type]}         [description]\n */\n\n\najax.post = function () {\n  for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n    args[_key2] = arguments[_key2];\n  }\n\n  var url = args[0],\n      data = args[1],\n      options = args[2];\n  return http(_objectSpread({\n    url: url,\n    data: data,\n    headers: {\n      'Content-Type': 'application/json; charset=utf-8'\n    },\n    method: 'post'\n  }, options));\n};\n/**\n * PUT操作\n * @param  {...[type]} args [description]\n * @return {[type]}         [description]\n */\n\n\najax.put = function () {\n  for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n    args[_key3] = arguments[_key3];\n  }\n\n  var url = args[0],\n      data = args[1],\n      options = args[2];\n  return http(_objectSpread({\n    url: url,\n    data: data,\n    headers: {\n      'Content-Type': 'application/json; charset=utf-8'\n    },\n    method: 'put'\n  }, options));\n};\n/**\n * 删除操作\n * @param  {...[type]} args [description]\n * @return {[type]}         [description]\n */\n\n\najax.delete = function () {\n  for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n    args[_key4] = arguments[_key4];\n  }\n\n  var url = args[0],\n      data = args[1],\n      options = args[2];\n  return http(_objectSpread({\n    url: url,\n    data: data,\n    headers: {\n      'Content-Type': 'application/json; charset=utf-8'\n    },\n    method: 'delete'\n  }, options));\n};\n/**\n * POSTJSON操作\n * @param  {...[type]} args [description]\n * @return {[type]}         [description]\n */\n\n\najax.postJSON = function () {\n  for (var _len5 = arguments.length, args = new Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {\n    args[_key5] = arguments[_key5];\n  }\n\n  var url = args[0],\n      data = args[1],\n      options = args[2];\n  return http(_objectSpread({\n    url: url,\n    data: data,\n    headers: {\n      'Content-Type': 'application/json; charset=utf-8'\n    },\n    method: 'post'\n  }, options));\n};\n/**\n * 上传文件\n * @param  {...[type]} args [description]\n * @return {[type]}         [description]\n */\n\n\najax.upload = function () {\n  for (var _len6 = arguments.length, args = new Array(_len6), _key6 = 0; _key6 < _len6; _key6++) {\n    args[_key6] = arguments[_key6];\n  }\n\n  var url = args[0],\n      data = args[1],\n      options = args[2];\n\n  if (!(data instanceof FormData)) {\n    throw TypeError('数据格式错误');\n  }\n\n  data.append('csrf_token', getToken());\n  return http(_objectSpread({\n    url: url,\n    data: data,\n    transformRequest: [function (data) {\n      return data;\n    }],\n    headers: {\n      'Content-Type': 'multipart/form-data'\n    },\n    method: 'post'\n  }, options));\n};\n\nexport default ajax;",{"version":3,"sources":["/Users/zhangoking/study/vue-cli/hello-word/src/utils/ajax/index.js"],"names":["Vue","axios","qs","formatIntercepter","codeIntercepter","statusIntercepter","error","vue","interceptors","loading","_csrfToken","http","create","baseURL","timeout","transformRequest","data","paramsSerializer","params","stringify","arrayFormat","request","use","method","toLowerCase","extendToken","FormData","$loading","fullscreen","response","_i","next","length","console","log","code","store","dispatch","reject","config","close","setToken","token","result","LOGOUT","user","showLogin","LOGINERROR","LOGINFAIL","AUTHCODE","$message","message","AUTH","setTimeout","FORMAT","getToken","process","env","NODE_ENV","window","localStorage","val","setItem","ajax","Object","defineProperty","enumerable","configurable","get","set","type","showClose","duration","args","url","options","post","headers","put","delete","postJSON","upload","TypeError","append"],"mappings":"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","sourcesContent":["import Vue from 'vue'\nimport axios from 'axios'\nimport qs from 'qs'\nimport {\n    formatIntercepter,\n    codeIntercepter,\n    statusIntercepter\n} from './middleware/interceptor'\nimport { error } from './middleware/enum'\n\nconst vue = new Vue()\n\n// 自定义拦截器\nconst interceptors = [\n    formatIntercepter,\n    codeIntercepter,\n    statusIntercepter\n]\n\nlet loading // 加载遮罩\n\nlet _csrfToken // token\n\n// 自定义axios实例\nconst http = axios.create({\n\n    baseURL: '/easyFm',\n\n    // ms\n    timeout: 15000,\n\n    // 只适用'POST'、'PUT'、'PATCH'，序列化参数\n    transformRequest: [function (data) {\n        return JSON.stringify(data)\n    }],\n\n    // GET请求，序列化参数，只有在有参数的情况先才会执行\n    paramsSerializer: function (params) {\n        return qs.stringify(params, {\n            arrayFormat: 'brackets'\n        })\n    }\n})\n\n/**\n * 请求拦截器\n * @return {[type]}          [description]\n */\nhttp.interceptors.request.use(function (request) {\n    let {\n        method,\n        data,\n        params\n    } = request\n\n    if (method.toLowerCase() === 'get') {\n        request.params = extendToken(params)\n    } else {\n        if ((data instanceof FormData)) {\n            request.data = data\n        } else {\n            request.data = extendToken(data)\n        }\n\n        // post请求不能重复提交\n        // 使用element loading全屏遮罩\n        loading = vue.$loading({\n            fullscreen: true\n        })\n    }\n    return request\n});\n\n/**\n * 扩展响应\n * @return {[type]}           [description]\n */\nhttp.interceptors.response.use(function (response) {\n    response._i = 0\n    response.next = function () {\n        if (response._i < interceptors.length) {\n            return interceptors[response._i++](response, response.next)\n        }\n    }\n    return response\n})\n\n/**\n * 响应拦截器\n * @return {[type]}                 [description]\n */\nhttp.interceptors.response.use(function (response) {\n    console.log(response.next())\n    let code = response.data.code\n    if (code == 218 || code == 219 || code == 217) {\n        store.dispatch('updateIsCertificateCode', code)\n        return Promise.reject(response)\n    }\n    const {\n        config,\n        data\n    } = response\n\n    if (config.method.toLowerCase() !== 'get') {\n        loading && loading.close()\n    }\n\n    setToken(data.token)\n    const result = response.next()\n    if (result) {\n\n        // 请求失败\n        switch (result) {\n            case error.LOGOUT:\n\n                // 未登录\n                user.showLogin()\n                break\n            case error.LOGINERROR:\n            case error.LOGINFAIL:\n            case error.AUTHCODE:\n\n                // 登录失败\n                vue.$message.error(data.message)\n                user.showLogin()\n                break\n            case error.AUTH:\n\n                // 没权限\n                vue.$message.error('权限已变更，请重新登录')\n                setTimeout(() => {\n                    user.showLogin()\n                }, 1000)\n\n                break\n            case error.FORMAT:\n\n                // 数据格式错误\n                vue.$message.error('接口数据格式错误')\n                break\n            default:\n\n                vue.$message.error(data.message)\n        }\n        return Promise.reject(data)\n    }\n    return data\n}, function (error) {\n    loading && loading.close()\n    console.log(error)\n    return Promise.reject(error)\n});\n\n\nfunction getToken() {\n    return _csrfToken || (process.env.NODE_ENV === 'production' ? window.localStorage['token'] : '')\n}\n\nfunction setToken(val) {\n    window.localStorage.setItem('token', val && (_csrfToken = val))\n}\n\nfunction extendToken(data) {\n\n    return {\n        ...data,\n        'csrf_token': getToken() // 添加token信息\n    }\n}\n\n/**\n * http工具函数\n * @param  {...[type]} config [description]\n * @return {[type]}         [description]\n */\nconst ajax = function (config) {\n\n    return http(config)\n}\n\nObject.defineProperty(ajax, 'csrfToken', {\n\n    enumerable: false,\n    configurable: false,\n    get() {\n        console.log('get')\n        return getToken()\n    },\n    set(val) {\n        console.log('set')\n        setToken(val)\n    }\n})\n\n/**\n * ajax消息提示\n * @param  {[type]}  message            [description]\n * @param  {String}  options.type      [description]\n * @param  {Boolean} options.showClose [description]\n * @param  {[type]}  options.duration  [description]\n * @return {[type]}                    [description]\n */\najax.message = function (message, {\n    type = 'error',\n    showClose = false,\n    duration = 3000\n} = {}) {\n    vue.$message({\n        message,\n        type,\n        showClose,\n        duration\n    })\n}\n\n/**\n * GET操作\n * @param  {...[type]} args [description]\n * @return {[type]}         [description]\n */\najax.get = function (...args) {\n\n    let [url, data, options] = args\n\n    return http({\n        url,\n        params: data,\n        method: 'get',\n        ...options\n    })\n}\n\n/**\n * POST操作\n * @param  {...[type]} args [description]\n * @return {[type]}         [description]\n */\najax.post = function (...args) {\n\n    let [url, data, options] = args\n\n    return http({\n        url,\n        data,\n        headers: {\n            'Content-Type': 'application/json; charset=utf-8'\n        },\n        method: 'post',\n        ...options\n    })\n}\n\n/**\n * PUT操作\n * @param  {...[type]} args [description]\n * @return {[type]}         [description]\n */\najax.put = function (...args) {\n\n    let [url, data, options] = args\n\n    return http({\n        url,\n        data,\n        headers: {\n            'Content-Type': 'application/json; charset=utf-8'\n        },\n        method: 'put',\n        ...options\n    })\n}\n\n/**\n * 删除操作\n * @param  {...[type]} args [description]\n * @return {[type]}         [description]\n */\najax.delete = function (...args) {\n\n    let [url, data, options] = args\n\n    return http({\n        url,\n        data: data,\n        headers: {\n            'Content-Type': 'application/json; charset=utf-8'\n        },\n        method: 'delete',\n        ...options\n    })\n}\n\n/**\n * POSTJSON操作\n * @param  {...[type]} args [description]\n * @return {[type]}         [description]\n */\najax.postJSON = function (...args) {\n\n    let [url, data, options] = args\n\n    return http({\n        url,\n        data,\n        headers: {\n            'Content-Type': 'application/json; charset=utf-8'\n        },\n        method: 'post',\n        ...options\n    })\n}\n\n/**\n * 上传文件\n * @param  {...[type]} args [description]\n * @return {[type]}         [description]\n */\najax.upload = function (...args) {\n\n    let [url, data, options] = args\n\n    if (!(data instanceof FormData)) {\n        throw TypeError('数据格式错误')\n    }\n\n    data.append('csrf_token', getToken())\n\n    return http({\n        url,\n        data,\n        transformRequest: [data => data],\n        headers: {\n            'Content-Type': 'multipart/form-data'\n        },\n        method: 'post',\n        ...options\n    })\n}\n\nexport default ajax\n"]}]}